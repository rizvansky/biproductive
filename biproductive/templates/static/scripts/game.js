// other themes to add ?
// bigger memory?

const library = {
    pokemon: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547980025/memory/Pokemon/Bulbasaur.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980083/memory/Pokemon/Charmander.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980101/memory/Pokemon/Squirtle.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980116/memory/Pokemon/Pikachu.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980129/memory/Pokemon/Mewtwo.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980142/memory/Pokemon/Mew.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980154/memory/Pokemon/Articuno.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980164/memory/Pokemon/Zapdos.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980175/memory/Pokemon/Moltres.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980186/memory/Pokemon/Eevee.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980025/memory/Pokemon/Bulbasaur.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980083/memory/Pokemon/Charmander.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980101/memory/Pokemon/Squirtle.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980116/memory/Pokemon/Pikachu.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980129/memory/Pokemon/Mewtwo.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980142/memory/Pokemon/Mew.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980154/memory/Pokemon/Articuno.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980164/memory/Pokemon/Zapdos.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980175/memory/Pokemon/Moltres.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980186/memory/Pokemon/Eevee.png"
    ],
    starwars: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547980981/memory/starwars/anakin%20skywalker.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981009/memory/starwars/luke%20skywalker.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981022/memory/starwars/Obi%20wann.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981054/memory/starwars/Han%20solo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981074/memory/starwars/chewbacca.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981095/memory/starwars/yoda.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981117/memory/starwars/dark%20sidious.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981141/memory/starwars/dark%20vador.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981165/memory/starwars/padme.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981190/memory/starwars/leia.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547980981/memory/starwars/anakin%20skywalker.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981009/memory/starwars/luke%20skywalker.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981022/memory/starwars/Obi%20wann.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981054/memory/starwars/Han%20solo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981074/memory/starwars/chewbacca.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981095/memory/starwars/yoda.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981117/memory/starwars/dark%20sidious.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981141/memory/starwars/dark%20vador.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981165/memory/starwars/padme.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981190/memory/starwars/leia.jpg"
    ],
    lotr: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547981408/memory/lotr/gandalf.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981438/memory/lotr/sauron.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981469/memory/lotr/Aragorn.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981501/memory/lotr/legolas.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981535/memory/lotr/Gimli.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981603/memory/lotr/golum.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981645/memory/lotr/sam.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981686/memory/lotr/saroumane.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981738/memory/lotr/bilbo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981802/memory/lotr/frodo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981408/memory/lotr/gandalf.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981438/memory/lotr/sauron.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981469/memory/lotr/Aragorn.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981501/memory/lotr/legolas.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981535/memory/lotr/Gimli.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981603/memory/lotr/golum.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981645/memory/lotr/sam.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981686/memory/lotr/saroumane.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981738/memory/lotr/bilbo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547981802/memory/lotr/frodo.jpg"
    ],
    disney: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547982044/memory/disney/mickey.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982088/memory/disney/mowgli.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982610/memory/disney/tarzan.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982620/memory/disney/simba.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982628/memory/disney/aladin.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982636/memory/disney/blanche%20neige.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982644/memory/disney/alice.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982653/memory/disney/peter%20pan.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982663/memory/disney/pinocchio.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982738/memory/disney/raiponce.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982044/memory/disney/mickey.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982088/memory/disney/mowgli.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982610/memory/disney/tarzan.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982620/memory/disney/simba.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982628/memory/disney/aladin.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982636/memory/disney/blanche%20neige.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982644/memory/disney/alice.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982653/memory/disney/peter%20pan.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982663/memory/disney/pinocchio.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982738/memory/disney/raiponce.jpg"
    ],
    pixar: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547982971/memory/pixar/up.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982987/memory/pixar/buzz.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983000/memory/pixar/woody.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983016/memory/pixar/Remy.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983032/memory/pixar/Mike.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983077/memory/pixar/Nemo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983114/memory/pixar/wall-e.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983169/memory/pixar/Mr-Incredible.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983381/memory/pixar/sully.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983403/memory/pixar/flash%20mcqueen.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982971/memory/pixar/up.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547982987/memory/pixar/buzz.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983000/memory/pixar/woody.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983016/memory/pixar/Remy.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983032/memory/pixar/Mike.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983077/memory/pixar/Nemo.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983114/memory/pixar/wall-e.png",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983169/memory/pixar/Mr-Incredible.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983381/memory/pixar/sully.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547983403/memory/pixar/flash%20mcqueen.jpg"
    ],
    harrypotter: [
        "https://res.cloudinary.com/beumsk/image/upload/v1547998926/memory/harrypotter/harry.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547998958/memory/harrypotter/ron.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547998992/memory/harrypotter/hermione.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999106/memory/harrypotter/dumbledore.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999032/memory/harrypotter/malfoy.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999143/memory/harrypotter/voldemort.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999401/memory/harrypotter/rogue.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999196/memory/harrypotter/hagrid.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999271/memory/harrypotter/sirius.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999577/memory/harrypotter/neville.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547998926/memory/harrypotter/harry.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547998958/memory/harrypotter/ron.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547998992/memory/harrypotter/hermione.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999106/memory/harrypotter/dumbledore.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999032/memory/harrypotter/malfoy.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999143/memory/harrypotter/voldemort.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999401/memory/harrypotter/rogue.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999196/memory/harrypotter/hagrid.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999271/memory/harrypotter/sirius.jpg",
        "https://res.cloudinary.com/beumsk/image/upload/v1547999577/memory/harrypotter/neville.jpg"
    ]
};

let images = [],
    tempElt1 = "",
    tempElt2 = "",
    click = -1,
    win = 0,
    score = 0,
    time = 0;

const preElt = document.querySelector("#pre"),
    themesElt = document.querySelector("#themes"),
    boxElts = document.getElementsByClassName("box"),
    mainElt = document.querySelector(".main"),
    timeElt = document.querySelector("#time"),
    scoreElt = document.querySelector("#score"),
    postElt = document.querySelector("#post"),
    finalElt = document.querySelector("#final"),
    againElt = document.querySelector("#again");

// initiate the game with chosen theme
themesElt.addEventListener("click", function (e) {
    if (e.target.classList.contains("themes")) {
        activateTheme(e.target.id);
        preElt.classList.add("hidden");
    }
});

async function postScore(url = "", data = {}) {
    const response = await fetch(url, {
        method: "POST",
        "mode": "cors",
        body: JSON.stringify(data)
    });
    return await response.json();
}

function activateTheme(theme) {
    // insert theme in images array
    switch (theme) {
        case "pokemon":
            for (let i = 0; i < 20; i++) {
                images.push(library.pokemon[i]);
            }
            break;
        case "starwars":
            for (let i = 0; i < 20; i++) {
                images.push(library.starwars[i]);
            }
            break;
        case "lotr":
            for (let i = 0; i < 20; i++) {
                images.push(library.lotr[i]);
            }
            break;
        case "disney":
            for (let i = 0; i < 20; i++) {
                images.push(library.disney[i]);
            }
            break;
        case "pixar":
            for (let i = 0; i < 20; i++) {
                images.push(library.pixar[i]);
            }
            break;
        case "harrypotter":
            for (let i = 0; i < 20; i++) {
                images.push(library.harrypotter[i]);
            }
            break;
    }
    // insert images in memory game
    for (let i = 0; i < 20; i++) {
        var rand = Math.floor(Math.random() * (images.length - 1));
        boxElts[i].innerHTML = "<img src='" + images[rand] + "' alt='image' class='hidden'>";
        images.splice(rand, 1);
    }
}


// Handle the play
mainElt.addEventListener("click", gameLogic);

function gameLogic(e) {
    // make sure the box is playable
    if (e.target.classList.contains("play")) {
        e.target.firstChild.classList.remove("hidden");
        // first of two click
        if (click < 1) {
            tempElt1 = e.target;
            // timer
            if (click === -1) {
                timer = setInterval(function () {
                    time++;
                    timeElt.innerHTML = time;
                }, 1000);
            }
            click = 1;
        }

        // second click
        else if (e.target !== tempElt1) {
            tempElt2 = e.target;

            // different images
            if (tempElt1.firstChild.src !== tempElt2.firstChild.src) {
                mainElt.removeEventListener("click", gameLogic);
                setTimeout(function () {
                    tempElt1.firstChild.classList.add("hidden");
                    tempElt2.firstChild.classList.add("hidden");
                    mainElt.addEventListener("click", gameLogic);
                }, 400);
                if (score > 0) {
                    score -= 2;
                }
                scoreElt.innerHTML = score;
            }

            // same images
            else {
                score += 10;
                win += 2;
                tempElt1.firstChild.classList.add("outlined");
                tempElt2.firstChild.classList.add("outlined");
                tempElt1.classList.remove("play");
                tempElt2.classList.remove("play");
                scoreElt.innerHTML = score;

                // game won
                if (win === 20) {
                    clearTimeout(timer);
                    e.preventDefault();
                    finalElt.innerHTML = "You won " + score + " points <br> in " + time + " seconds";

                    postScore("/productivity/", {"prod_score": score}).then((data) => {
                        console.log("Send ", data, "to django");
                    })
                    postElt.classList.remove("hidden");
                }
            }
            click = 0;
        }
    }
}

againElt.addEventListener("click", resetGame);

function resetGame() {
    // reset game
    tempElt1 = "";
    tempElt2 = "";
    click = -1;
    win = 0;
    score = 0;
    time = 0;
    postElt.classList.add("hidden");
    preElt.classList.remove("hidden");
    for (let i = 0; i < 20; i++) {
        boxElts[i].classList.add("play");
        boxElts[i].firstChild.classList.add("hidden");
    }
    timeElt.textContent = time;
    scoreElt.textContent = score;
}